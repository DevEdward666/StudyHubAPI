# Push Notification System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        StudyHub Ecosystem                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Client App     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Backend API    â”‚         â”‚
â”‚  â”‚  (React/Ionic)   â”‚   REST API   â”‚   (ASP.NET)      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                  â”‚                    â”‚
â”‚           â”‚                                  â”‚                    â”‚
â”‚           â–¼                                  â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Service Worker   â”‚              â”‚   PostgreSQL     â”‚         â”‚
â”‚  â”‚    (sw.js)       â”‚              â”‚   Database       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚                                                       â”‚
â”‚           â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  Browser Push    â”‚                                           â”‚
â”‚  â”‚   Notification   â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Details

### Frontend (Client App)
```
study_hub_app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ push-notification.service.ts
â”‚   â”‚       â”œâ”€â”€ registerServiceWorker()
â”‚   â”‚       â”œâ”€â”€ subscribe()
â”‚   â”‚       â”œâ”€â”€ unsubscribe()
â”‚   â”‚       â””â”€â”€ showLocalNotification()
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ usePushNotification.ts
â”‚   â”‚       â”œâ”€â”€ permission state
â”‚   â”‚       â”œâ”€â”€ subscription state
â”‚   â”‚       â””â”€â”€ methods
â”‚   â”‚
â”‚   â”œâ”€â”€ components/notifications/
â”‚   â”‚   â”œâ”€â”€ PushNotificationSettings.tsx
â”‚   â”‚   â””â”€â”€ PushNotificationInitializer.tsx
â”‚   â”‚
â”‚   â””â”€â”€ pages/dashboard/
â”‚       â”œâ”€â”€ TableScanner.tsx  â† Triggers on session start
â”‚       â””â”€â”€ Dashboard.tsx     â† Triggers on session end
â”‚
â””â”€â”€ public/
    â””â”€â”€ sw.js  â† Handles push events
```

### Backend (API)
```
Study-Hub/
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ PushController.cs
â”‚       â”œâ”€â”€ GET  /api/push/vapid-public-key
â”‚       â”œâ”€â”€ POST /api/push/subscribe
â”‚       â”œâ”€â”€ POST /api/push/unsubscribe
â”‚       â”œâ”€â”€ GET  /api/push/subscriptions
â”‚       â”œâ”€â”€ POST /api/push/test
â”‚       â”œâ”€â”€ POST /api/push/send
â”‚       â””â”€â”€ POST /api/push/broadcast
â”‚
â”œâ”€â”€ Service/
â”‚   â””â”€â”€ PushNotificationService.cs
â”‚       â”œâ”€â”€ SubscribeAsync()
â”‚       â”œâ”€â”€ UnsubscribeAsync()
â”‚       â”œâ”€â”€ SendPushNotificationAsync()
â”‚       â””â”€â”€ SendPushNotificationToUsersAsync()
â”‚
â””â”€â”€ Models/
    â”œâ”€â”€ Entities/PushSubscription.cs
    â””â”€â”€ DTOs/PushDto.cs
```

## Data Flow Diagrams

### 1. Initial Setup Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â”€â–ºâ”‚   App   â”‚â”€â”€â”€â”€â–ºâ”‚ Service â”‚â”€â”€â”€â”€â–ºâ”‚ Browser â”‚
â”‚ Opens   â”‚     â”‚  Loads  â”‚     â”‚ Worker  â”‚     â”‚ Prompt  â”‚
â”‚  App    â”‚     â”‚         â”‚     â”‚Register â”‚     â”‚Permissionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  User   â”‚
                                                 â”‚Grants orâ”‚
                                                 â”‚ Denies  â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚                     â”‚
                           [Granted]              [Denied]
                                 â”‚                     â”‚
                                 â–¼                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Subscribe to â”‚      â”‚Show Settings â”‚
                        â”‚   Backend    â”‚      â”‚ Instructions â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Session Start Flow
```
User Scans QR Code
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TableScanner  â”‚
â”‚  Component   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Confirm Session Details]
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Start Session â”‚
â”‚  API Call    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Success]
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigate to  â”‚      â”‚ Send Local Push  â”‚
â”‚  Dashboard   â”‚      â”‚   Notification   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Service Worker   â”‚
                      â”‚ Shows Notificationâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ User Sees:       â”‚
                      â”‚ "Study Session   â”‚
                      â”‚  Started! ğŸ¯"    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Session End Flow
```
User Clicks "End Session"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard   â”‚
â”‚  Component   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Calculate Duration]
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ End Session  â”‚
â”‚   API Call   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Success]
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Refresh Data  â”‚      â”‚ Send Local Push  â”‚
â”‚  & UI        â”‚      â”‚   Notification   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Service Worker   â”‚
                      â”‚ Shows Notificationâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ User Sees:       â”‚
                      â”‚ "Session         â”‚
                      â”‚  Completed! ğŸ‰"  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Subscription Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     GET /vapid-public-key      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Backend â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                           â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚        { publicKey: "..." }               â”‚
     â”‚                                           â”‚
     â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚Subscribeâ”‚                                     â”‚
â”‚  to     â”‚                                     â”‚
â”‚Browser  â”‚                                     â”‚
â”‚Push API â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
     â”‚                                           â”‚
     â”‚        POST /subscribe                   â”‚
     â”‚       { endpoint, keys }                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                                           â”‚
     â”‚                                           â–¼
     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                    â”‚  Save   â”‚
     â”‚                                    â”‚   to    â”‚
     â”‚                                    â”‚Database â”‚
     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                           â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚           Success Response                â”‚
     â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  User   â”‚                                     â”‚
â”‚is now   â”‚                                     â”‚
â”‚subscribedâ”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
```

## Database Schema

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          push_subscriptions                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              UUID (PK)                    â”‚
â”‚ user_id         UUID (FK -> users)           â”‚
â”‚ endpoint        VARCHAR(500) UNIQUE          â”‚
â”‚ p256dh          VARCHAR(200)                 â”‚
â”‚ auth            VARCHAR(200)                 â”‚
â”‚ is_active       BOOLEAN                      â”‚
â”‚ user_agent      VARCHAR(500)                 â”‚
â”‚ created_at      TIMESTAMP                    â”‚
â”‚ updated_at      TIMESTAMP                    â”‚
â”‚ last_used_at    TIMESTAMP                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Indexes:
         â”œâ”€ IX_push_subscriptions_user_id
         â”œâ”€ IX_push_subscriptions_endpoint (UNIQUE)
         â””â”€ IX_push_subscriptions_is_active
```

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           VAPID Authentication              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  1. Backend generates VAPID key pair        â”‚
â”‚     (Public + Private key)                  â”‚
â”‚                                             â”‚
â”‚  2. Public key shared with client           â”‚
â”‚     (Safe to expose)                        â”‚
â”‚                                             â”‚
â”‚  3. Private key stays on backend            â”‚
â”‚     (Never exposed)                         â”‚
â”‚                                             â”‚
â”‚  4. Client uses public key to subscribe     â”‚
â”‚     to browser push service                 â”‚
â”‚                                             â”‚
â”‚  5. Backend uses private key to sign        â”‚
â”‚     push messages (proves authenticity)     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JWT Authentication Flow             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  All API calls include:                     â”‚
â”‚  Authorization: Bearer <JWT_TOKEN>          â”‚
â”‚                                             â”‚
â”‚  Protected endpoints:                       â”‚
â”‚  - POST /subscribe                          â”‚
â”‚  - POST /unsubscribe                        â”‚
â”‚  - GET  /subscriptions                      â”‚
â”‚  - POST /test                               â”‚
â”‚  - POST /send (Admin only)                  â”‚
â”‚  - POST /broadcast (Admin only)             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend Stack                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ React 19.0.0                              â”‚
â”‚ â€¢ Ionic Framework 8.7.3                     â”‚
â”‚ â€¢ TypeScript 5.7.2                          â”‚
â”‚ â€¢ Vite 6.2.0                                â”‚
â”‚ â€¢ Service Workers API                       â”‚
â”‚ â€¢ Push API                                  â”‚
â”‚ â€¢ Notifications API                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Stack                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ASP.NET Core 8.0                          â”‚
â”‚ â€¢ C# / .NET 8                               â”‚
â”‚ â€¢ Entity Framework Core 9.0.9               â”‚
â”‚ â€¢ PostgreSQL                                â”‚
â”‚ â€¢ Lib.Net.Http.WebPush 3.3.1                â”‚
â”‚ â€¢ JWT Authentication                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Notification Payload Structure

```json
{
  "notification": {
    "title": "Study Session Started! ğŸ¯",
    "body": "Your 2 hour study session at Building A - Table 5 has begun.",
    "icon": "/icon.png",
    "badge": "/badge.png",
    "tag": "session-start",
    "data": {
      "type": "session-start",
      "tableId": "uuid-here",
      "tableNumber": "5",
      "location": "Building A",
      "duration": 2
    }
  }
}
```

## Performance Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Expected Performance                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ Service Worker Registration: < 100ms        â”‚
â”‚ Permission Request: Instant                 â”‚
â”‚ Subscription to Backend: < 500ms            â”‚
â”‚ Local Notification Display: < 50ms          â”‚
â”‚ API Response Time: < 200ms                  â”‚
â”‚                                             â”‚
â”‚ Browser Support: 95%+ of users              â”‚
â”‚ Mobile Support: iOS 16.4+, Android 5.0+     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Try Action  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   [Success?]
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€Yesâ”€â”€â”€â”€â”€â”€â–º[Continue]
       â”‚
       â–¼
      No
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Catch Error â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º[Log to Console]
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º[Show User Message (optional)]
       â”‚
       â””â”€â”€â”€â”€â”€â”€â–º[Graceful Degradation]
                (App continues to work)
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Push Notification States        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ â€¢ isSupported: boolean               â”‚
â”‚ â€¢ permission: NotificationPermission â”‚
â”‚   - "default"                        â”‚
â”‚   - "granted"                        â”‚
â”‚   - "denied"                         â”‚
â”‚                                      â”‚
â”‚ â€¢ isSubscribed: boolean              â”‚
â”‚ â€¢ isLoading: boolean                 â”‚
â”‚ â€¢ error: string | null               â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This architecture provides:
- âœ… End-to-end push notification system
- âœ… Secure VAPID authentication
- âœ… JWT-protected API endpoints
- âœ… Persistent subscription storage
- âœ… Service worker for offline support
- âœ… Graceful error handling
- âœ… Cross-browser compatibility
- âœ… Mobile-friendly implementation

**Status: Production Ready** ğŸš€

