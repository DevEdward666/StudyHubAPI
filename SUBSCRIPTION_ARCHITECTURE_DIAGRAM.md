# Subscription System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          SUBSCRIPTION SYSTEM OVERVIEW                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐
│   ADMIN/USER         │
└──────────┬───────────┘
           │
           ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              API LAYER                                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────────────────┐     ┌──────────────────────────────┐       │
│  │  SubscriptionsController    │     │   TablesController           │       │
│  ├─────────────────────────────┤     ├──────────────────────────────┤       │
│  │ • GET /packages             │     │ • POST /start-subscription   │       │
│  │ • POST /packages            │     │ • POST /end-subscription     │       │
│  │ • PUT /packages/{id}        │     │                              │       │
│  │ • POST /purchase            │     │                              │       │
│  │ • GET /my-subscriptions     │     │                              │       │
│  │ • POST /admin/purchase      │     │                              │       │
│  │ • GET /admin/all            │     │                              │       │
│  └─────────────┬───────────────┘     └──────────────┬───────────────┘       │
│                │                                     │                        │
└────────────────┼─────────────────────────────────────┼────────────────────────┘
                 │                                     │
                 ▼                                     ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                           SERVICE LAYER                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────────────────┐     ┌──────────────────────────────┐       │
│  │  SubscriptionService        │     │   TableService               │       │
│  ├─────────────────────────────┤     ├──────────────────────────────┤       │
│  │ • CreatePackage()           │     │ • StartSubscriptionSession() │       │
│  │ • GetPackages()             │     │ • EndSubscriptionSession()   │       │
│  │ • PurchaseSubscription()    │     │ • (deducts hours)            │       │
│  │ • GetUserSubscriptions()    │     │ • (updates status)           │       │
│  │ • CancelSubscription()      │     │                              │       │
│  └─────────────┬───────────────┘     └──────────────┬───────────────┘       │
│                │                                     │                        │
└────────────────┼─────────────────────────────────────┼────────────────────────┘
                 │                                     │
                 ▼                                     ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                          DATABASE LAYER                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────────────┐   ┌─────────────────────┐   ┌─────────────────┐  │
│  │ subscription_packages│   │ user_subscriptions  │   │ table_sessions  │  │
│  ├──────────────────────┤   ├─────────────────────┤   ├─────────────────┤  │
│  │ • id                 │   │ • id                │   │ • id            │  │
│  │ • name              │◄──┤ • package_id        │   │ • subscription_id─┤ │
│  │ • package_type       │   │ • user_id          │◄──┤ • user_id       │  │
│  │ • total_hours        │   │ • total_hours       │   │ • table_id      │  │
│  │ • price              │   │ • remaining_hours   │   │ • hours_consumed│  │
│  │ • is_active          │   │ • hours_used        │   │ • start_time    │  │
│  │ • display_order      │   │ • status            │   │ • end_time      │  │
│  └──────────────────────┘   │ • purchase_date     │   │ • is_subscription│ │
│                              │ • activation_date   │   │   _based        │  │
│                              └─────────────────────┘   └─────────────────┘  │
│                                                                               │
└──────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         SUBSCRIPTION LIFECYCLE                               │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
  │          │      │          │      │          │      │          │
  │ PURCHASE │─────►│  ACTIVE  │─────►│  USING   │─────►│ EXPIRED  │
  │          │      │          │      │          │      │          │
  └──────────┘      └────┬─────┘      └──────────┘      └──────────┘
                         │
                         │ (cancel)
                         ▼
                    ┌──────────┐
                    │          │
                    │CANCELLED │
                    │          │
                    └──────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                        SESSION WORKFLOW                                      │
└─────────────────────────────────────────────────────────────────────────────┘

    USER ARRIVES                ADMIN ACTIONS              SYSTEM UPDATES
         │                            │                           │
         ▼                            ▼                           │
    ┌─────────┐              ┌────────────────┐                  │
    │ Check   │              │ 1. Find active │                  │
    │ Subscription          │    subscription│                  │
    └─────────┘              └───────┬────────┘                  │
         │                            │                           │
         │                            ▼                           │
         │                   ┌────────────────┐                  │
         │                   │ 2. Assign      │                  │
         │                   │    available   │                  │
         │                   │    table       │                  │
         │                   └───────┬────────┘                  │
         │                            │                           │
         │                            ▼                           │
         │                   ┌────────────────┐         ┌────────▼────────┐
         │                   │ 3. Start       │────────►│ • Create session│
         │                   │    session     │         │ • Mark table    │
         │                   └───────┬────────┘         │   occupied      │
         │                            │                 └─────────────────┘
         ▼                            │
    ┌─────────┐                       │
    │ USER    │                       │
    │ STUDIES │                       │
    │         │                       │
    └────┬────┘                       │
         │                            ▼
         │                   ┌────────────────┐         ┌─────────────────┐
         ▼                   │ 4. End         │────────►│ • Calc hours    │
    ┌─────────┐              │    session     │         │ • Deduct hours  │
    │ USER    │              └────────────────┘         │ • Update status │
    │ LEAVES  │                                         │ • Free table    │
    └─────────┘                                         └─────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                      TIME TRACKING EXAMPLE                                   │
└─────────────────────────────────────────────────────────────────────────────┘

    PACKAGE PURCHASE                    SESSIONS                    STATUS
    ─────────────────                   ────────                    ──────

    1 Week Package           Day 1: 9 AM - 2 PM (5h)                ACTIVE
    168 hours                     ↓                                 Remaining:
    ₱5,000                   Remaining: 163h                        163 hours
       │
       │                     Day 2: 10 AM - 4 PM (6h)               ACTIVE
       │                          ↓                                 Remaining:
       ├────────────────►    Remaining: 157h                        157 hours
       │
       │                     Day 5: 8 AM - 6 PM (10h)               ACTIVE
       │                          ↓                                 Remaining:
       │                     Remaining: 147h                        147 hours
       │
       │                     ... continues ...
       │
       │                     Day 20: 2 PM - 4 PM (2h)               ACTIVE
       │                          ↓                                 Remaining:
       └────────────────►    Remaining: 0h                          0 hours
                                 ↓
                            STATUS: EXPIRED                         EXPIRED


┌─────────────────────────────────────────────────────────────────────────────┐
│                      PACKAGE TYPES COMPARISON                                │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌───────────┬──────────┬─────────────┬──────────┬────────────────────┐
    │  Package  │ Duration │ Total Hours │  Price   │   Best For         │
    ├───────────┼──────────┼─────────────┼──────────┼────────────────────┤
    │ 10 Hours  │   N/A    │     10      │  ₱500    │ Trying service     │
    │ 1 Day     │  1 day   │     24      │  ₱1,000  │ One-time event     │
    │ 1 Week    │  7 days  │    168      │  ₱5,000  │ Exam preparation   │
    │ 1 Month   │ 30 days  │    720      │  ₱15,000 │ Regular students   │
    │ 3 Months  │ 90 days  │   2,160     │  ₱40,000 │ Long-term projects │
    └───────────┴──────────┴─────────────┴──────────┴────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         DATA FLOW DIAGRAM                                    │
└─────────────────────────────────────────────────────────────────────────────┘

    PURCHASE FLOW:
    ──────────────
    Admin ──► Select Package ──► Payment ──► Create Subscription
                                                      │
                                                      ▼
                                              ┌───────────────────┐
                                              │ User Subscription │
                                              │ ─────────────────│
                                              │ Total: 168h       │
                                              │ Remaining: 168h   │
                                              │ Status: Active    │
                                              └───────────────────┘

    SESSION FLOW:
    ─────────────
    User Arrives ──► Check Subscription ──► Start Session
                            │                       │
                            ▼                       ▼
                    ┌──────────────┐       ┌───────────────┐
                    │ Active: ✓    │       │ Table Session │
                    │ Hours: 168   │       │ Start: 9 AM   │
                    └──────────────┘       └───────┬───────┘
                                                    │
                    User Leaves ◄───────────────────┘
                            │
                            ▼
                    End Session ──► Calculate Hours ──► Update
                                           │                │
                                           ▼                ▼
                                    Duration: 5h    ┌──────────────┐
                                                    │ Remaining:   │
                                                    │ 168h - 5h    │
                                                    │ = 163h       │
                                                    └──────────────┘
```

